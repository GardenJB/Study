
## 트랜잭션

:  데이터베이스의 상태를 변화시키기 위해서 수행하는 작업의 단위

SELECT / INSERT / DELETE / UPDATE

>> 전부 실행 or 전부 실행 x

데이터베이스 로그 파일 

- *.mdf (.ndf)> 데이터 파일 : 실제 데이터…
- *.ldf > 트랜잭션 로그 파일(순차적 기록)
    - 응급상황 발생시 입력 데이터 완전하도록 해줌
    - SELECT 문과는 관계 없음 주의! ~~(조회 > 로그 발생 x)~~
- 트랜잭션 발생 > *.ldf에만 기록 > COMMIT TRAN 실행해야 > *.mdf에 기록  + 체크 포인트 표시 ⭐
- 원자성
    - 트랜잭션이 데이터베이스에 모두 반영 or 전혀 반영되지 않아야 함
- 일관성
    - 트랜잭션 작업 처리 결과 항상 일관성 유지
    - 트랜잭션 진행 중 데이터베이스 변경이 있더라도 기존 데이터베이스로 트랜잭션 진행
- 격리성 / 독립성
    - (둘 이상의 트랜잭션이 동시 실행 경우) 어떤 하나의 트랜잭션이라도 다른 트랜잭션의 연산에 끼어들 수 없음
    - 완료 전까지 결과를 참조할 수 없음
- 지속성
    - 트랜잭션이 성공적으로 완료된 경우, 결과는 영구적으로 반영되어야 함

- 익스텐트(extent) = 8페이지 = 64Kbyte
- 페이지 = 8kbyte

: 하나의 논리적 작업 단위로 수행되는 일련의 작업

- 작업단위는 사람이 정하는 기준에 따라 정해짐
    
    
- SQL의 묶음
    
    

→ SQL문 각 한 줄 모음( 설정을 안 한 경우)

Begin … Commit… 묶음(명시가 없으면 각 줄(;) 실행)

그 이전까지는 잠금 > 외부에서 접근/반영 불가

- Commit : 트랜잭션 완료 및 데이터베이스 일관성 유지
    - 하나의 트랜잭션이 끝났음을 표시
        
        → 수행 트랜잭션 로그 저장 
        
- Rollback : 하나의 트랜잭션 처리가 비정상적으로 종료된 경우, 트랜잭션을 처음부터 다시 시작 or 부분적인 연산 결과를 취소

- COMMIT 이전 작업 > 취소
- COMMIT > 로그 파일과 데이터 파일 비교 후 미완 작업 수행 > 완료
- 제약 조건 논리적 오류는 롤백 x > 강제 롤백 필요

```sql
BEGIN TRAN
	SQL 문...
COMMIT TRAN(|COMMIT WORK|ROLLBACK TRAN)

// COMMIT TRAN > 트랜잭션 이름 지정 커밋 가능 
	 COMMIT WORK > 현재 가장 가까운 트랜잭션 커밋

* 트랜잭션 중간 저장
	SAVE TRAN 저장점명

* 자동 커밋 트랜잭션
	 > 문마다 BEGIN ... COMMIT ... 자동 처리

* 명시적 트랜잭션
	 > BEGIN ... COMMIT ... 직접 작성

* 암시적 트랜잭션
	 : 자동으로 내부적인 BEGIN TRAN 처리 
				b COMMIT TRAN / ROLLBACK TRAN 직접 작성 필요
			>> 권장 x, 오라클 호환 기능
	
		SET IMPLICIT_TRANSASCTIONS ON

* 트랜잭션 구문에서 활용 
	>> TRY ... CATCH... 사용 ROLLBACK 설정

	** 현재 진행 중인 트랜잭션 수 조회
			SELECT @@TRANCOUNT;

	** 롤백 > (모두 롤백 > SAVE TRAN 으로 지점 설정 가능)
 
```